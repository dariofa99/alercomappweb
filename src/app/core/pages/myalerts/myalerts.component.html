<div class="container p-4" *ngIf="isOnAlert">
    <mat-card *ngFor="let alert of alerts;let j=index" class="example-card mb-3">
        <mat-card-title class="pb-2">Estado: {{alert.status.reference_name}}</mat-card-title>
        <mat-card-subtitle>Fecha de Creación: {{alert.event_date}}</mat-card-subtitle>
        <mat-card-subtitle>
            <p class="font-weight-bold">{{alert.user.name + " " + alert.user.lastname}} <a class="font-weight-ligth"><small>Ver perfil</small></a></p>
        </mat-card-subtitle>
        <mat-card-content class="mb-2">
            <p>{{alert.event_description}}</p>
            <p>Se envío desde: {{alert.event_place}}</p>
            <p>{{alert.event_aditional_information}}</p>
        </mat-card-content>
        <mat-divider inset class="pb-3"></mat-divider>
        <mat-card-actions class="d-flex justify-content-end">
            <button (click)="onSeeDetails(alert)" mat-button><label class="mb-0" for="seeDetails"><a>Ver</a></label></button>
            <button mat-button data-toggle="modal" data-target="#exampleModalLong"><label class="mb-0" for="changeState"><a>Cambiar estado</a></label></button>
        </mat-card-actions>
        <mat-card-footer>
            <mat-progress-bar mode=""></mat-progress-bar>
        </mat-card-footer>
    </mat-card>
</div>

<div class="container p-4" *ngIf="isOnAlertDetails">
    <mat-card class="example-card">
        <mat-card-title class="pb-2">Estado: {{alertDetails.status.reference_name}}</mat-card-title>
        <mat-card-subtitle>Fecha de Creación: {{alertDetails.event_date}}</mat-card-subtitle>
        <mat-card-content>
            <p>{{alertDetails.event_description}}</p>
            <p>Enviado desde {{alertDetails.event_place}}</p>
            <agm-map [latitude]="toFloat(alertDetails.latitude)" [longitude]="toFloat(alertDetails.longitude)" [mapTypeId]="mapType" [zoom]="18">
            </agm-map>
            <br>
            <p>{{alertDetails.event_aditional_information}}</p>

            <mat-checkbox class="example-margin" [checked]="alertDetails.affected_people" [color]="" (change)="checkboxChanged($event.checked)">
                Afectó a las Personas
            </mat-checkbox>
            <br>
            <mat-checkbox class="example-margin" [checked]="alertDetails.affected_family" [color]="" (change)="checkboxChanged($event.checked)">
                Afectó a la Familia
            </mat-checkbox>
            <br>
            <mat-checkbox class="example-margin" [checked]="alertDetails.affected_animals" [color]="" (change)="checkboxChanged($event.checked)">
                Afectó a los Animales
            </mat-checkbox>
            <br>
            <mat-checkbox class="example-margin" [checked]="alertDetails.affected_infrastructure" [color]="" (change)="checkboxChanged($event.checked)">
                Afectó a la Infraestructura
            </mat-checkbox>
            <br>
            <mat-checkbox class="example-margin" [checked]="alertDetails.affected_livelihoods" [color]="" (change)="checkboxChanged($event.checked)">
                Afectó a los Medios de Subsistencia
            </mat-checkbox>
            <br>
            <label for="Tipo de Alerta">Tipo de Alerta</label>
            <select (change)="onEventTypeSelected($event)" name="event_type_id" class="form-control select2" style="width: 100%;">
                <option value="">Seleccione un tipo de alerta</option>
                <option *ngFor="let eventType of eventTypes" [selected]="alertDetails.event_type_id == eventType.id" [value]="eventType.id">{{eventType.event_type_name}}</option>
            </select>
            <br>
            <label for="Municipio">Municipio</label>
            <select (change)="onEventTypeSelected($event)" name="event_type_id" class="form-control select2" style="width: 100%;">
                <option value="">Seleccione el municipio</option>
                <option [selected]="alertDetails.town_id == alertDetails.town_id" [value]="alertDetails.town_id">{{alertDetails.town.town_name}}</option>
            </select>
            <br>
            <label for="Rango de Afectación">Rango de Afectación</label>
            <select (change)="onEventTypeSelected($event)" name="event_type_id" class="form-control select2" style="width: 100%;">
                <option value="">Seleccione un rango de afectación</option>
                <option *ngFor="let affectRange of affectRanges" [selected]="alertDetails.afectations_range_id == affectRange.id" [value]="affectRange.id">{{affectRange.reference_name}}</option>
            </select>

        </mat-card-content>
        <mat-divider inset></mat-divider>
        <mat-card-actions class="d-flex justify-content-end">
            <button mat-button (click)="backToList()"><label class="mb-0" for="backToList">Regresar</label></button>
            <button mat-button><label class="mb-0" for="changeState"><a data-toggle="modal" data-target="#exampleModalLong" >Cambiar estado</a></label></button>
        </mat-card-actions>
        <mat-card-footer>
            <mat-progress-bar mode=""></mat-progress-bar>
        </mat-card-footer>
    </mat-card>
</div>

<style>
    agm-map {
        height: 300px;
    }
</style>

<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Cambiar Estado</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
            </div>
            <div class="modal-body">
                <select name="state_id" class="form-control select2" style="width: 100%;">
                    <option value="">Seleccione un tipo de estado</option>
                    <option seletected >Alertado</option>
                    <option>Inactivo</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Declinar</button>
                <button type="button" class="btn btn-primary">Aceptar</button>
            </div>
        </div>
    </div>
</div>